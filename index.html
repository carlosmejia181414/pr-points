<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora OINP — Foreign Worker Stream (EOI) — Tabla oficial</title>
  <style>
    body{font-family:Arial, Helvetica, sans-serif;max-width:960px;margin:20px auto;padding:14px;color:#111}
    h1{font-size:1.4rem;margin-bottom:4px}
    label{display:block;margin:8px 0 4px;font-weight:600}
    input,select,button{padding:8px;border:1px solid #bbb;border-radius:6px;width:100%;box-sizing:border-box;font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .card{padding:14px;border-radius:8px;background:#f9f9f9;border:1px solid #eee;margin-bottom:12px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #ccc;padding:8px;text-align:left}
    th{background:#f1f1f1}
    .result{background:#eaf8ef;border:1px solid #cfead5;padding:10px;border-radius:6px;margin-top:10px}
    .small{font-size:13px;color:#666}
    .help{font-size:13px;color:#444;margin-top:6px;background:#fff;padding:8px;border-radius:6px;border:1px solid #eee}
    button{cursor:pointer}
  </style>
</head>
<body>
  <h1>Calculadora OINP — Employer Job Offer: Foreign Worker Stream</h1>
  <p class="small">Formulario basado en las tablas oficiales del OINP. Calcula tu puntaje estimado para el stream “Foreign Worker”.</p>

  <div class="card">
    <h3>Employment / labour market factors (Oferta de trabajo)</h3>

    <label for="teer">Job offer: NOC TEER category *</label>
    <select id="teer" aria-describedby="help-teer">
      <option value="">-- Selecciona --</option>
      <option value="10">TEER 0 or 1 — 10 puntos</option>
      <option value="8">TEER 2 or 3 — 8 puntos</option>
      <option value="0">TEER 4 — 0 puntos</option>
      <option value="0">TEER 5 — 0 puntos</option>
    </select>
    <div id="help-teer" class="help">
      <strong>Descripción:</strong> TEER 0 y 1 incluyen ocupaciones gerenciales y profesionales de alto nivel (por ejemplo, gerentes y profesionales altamente calificados). Estas posiciones suelen requerir educación avanzada y experiencia significativa; por eso reciben la máxima puntuación. TEER 2/3 son ocupaciones técnicas o especializadas con formación postsecundaria o certificaciones. TEER 4 y 5 corresponden a niveles técnicos o elementales y no suman puntos en este criterio.
    </div>

    <label for="occCat">Job offer: NOC broad occupational category *</label>
    <select id="occCat" aria-describedby="help-occ">
      <option value="">-- Selecciona --</option>
      <option value="10">Occupational category 0,2,3 — 10 puntos</option>
      <option value="7">Occupational category 7 — 7 puntos</option>
      <option value="5">Occupational category 1,9 — 5 puntos</option>
      <option value="4">Occupational category 4,8 — 4 puntos</option>
      <option value="3">Occupational category 5,6 — 3 puntos</option>
    </select>
    <div id="help-occ" class="help">
      <strong>Descripción:</strong> Las categorías 0,2,3 incluyen puestos de gestión, profesionales y del sector salud/ciencias; reciben la puntuación máxima. Otras categorías (7, 1/9, 4/8, 5/6) reflejan distintos niveles de prioridad económica y reciben puntuaciones decrecientes según su importancia y requerimientos de habilidad.
    </div>

    <label for="wage">Job offer: wage (por hora, CAD) *</label>
    <select id="wage" aria-describedby="help-wage">
      <option value="">-- Selecciona --</option>
      <option value="10">$40 per hour or higher — 10 puntos</option>
      <option value="8">$35 to $39.99 per hour — 8 puntos</option>
      <option value="7">$30 to $34.99 per hour — 7 puntos</option>
      <option value="6">$25 to $29.99 per hour — 6 puntos</option>
      <option value="5">$20 to $24.99 per hour — 5 puntos</option>
      <option value="0">Less than $20 per hour — 0 puntos</option>
    </select>
    <div id="help-wage" class="help">
      <strong>Descripción:</strong> El salario por hora refleja la competitividad de la oferta. Salarios más altos ($40+/h) indican mayor prioridad económica y reciben más puntos. Rangos intermedios reciben puntuación proporcional; salarios por debajo de $20/h no suman puntos.
    </div>

    <h3>Permiso y relación con el empleador</h3>
    <label for="workPermit">Work permit status *</label>
    <select id="workPermit" aria-describedby="help-permit">
      <option value="">-- Selecciona --</option>
      <option value="10">With valid work permit — 10 puntos</option>
      <option value="0">Without valid work permit — 0 puntos</option>
    </select>
    <div id="help-permit" class="help">
      <strong>Descripción:</strong> Indica si el candidato posee actualmente un permiso de trabajo válido en Canadá (y normalmente en Ontario). Tener un permiso vigente demuestra elegibilidad inmediata y suma puntos.
    </div>

    <label for="tenure">Job tenure with job-offer employer *</label>
    <select id="tenure" aria-describedby="help-tenure">
      <option value="">-- Selecciona --</option>
      <option value="3">6 months or more working in job-offer position — 3 puntos</option>
      <option value="0">Less than 6 months or not currently working in position — 0 puntos</option>
    </select>
    <div id="help-tenure" class="help">
      <strong>Descripción:</strong> Mide la continuidad del trabajador con el empleador que ofrece el puesto. 6 meses o más en la posición demuestra estabilidad y suma puntos.
    </div>

    <h3>Canadian work experience</h3>
    <label for="earnings">Canadian work experience: earnings history (último 5 años) *</label>
    <select id="earnings" aria-describedby="help-earn">
      <option value="">-- Selecciona --</option>
      <option value="3">$40k or more earnings in a year — 3 puntos</option>
      <option value="0">Less than $40k — 0 puntos</option>
    </select>
    <div id="help-earn" class="help">
      <strong>Descripción:</strong> Se refiere a ingresos reportados (por ejemplo, Notices of Assessment del CRA). Ganar $40,000 CAD o más en al menos un año de los últimos cinco suele otorgar puntos por capacidad económica y estabilidad.
    </div>

    <h3>Language</h3>
    <label for="clbOverall">Official language ability (usar CLB) *</label>
    <select id="clbOverall" aria-describedby="help-clb">
      <option value="">-- Selecciona --</option>
      <option value="10">CLB 9 or higher — 10 puntos</option>
      <option value="6">CLB 8 — 6 puntos</option>
      <option value="4">CLB 7 — 4 puntos</option>
      <option value="0">CLB 6 or lower — 0 puntos</option>
    </select>
    <div id="help-clb" class="help">
      <strong>Descripción:</strong> Evalúa la habilidad en el idioma oficial (inglés o francés) usando el Canadian Language Benchmark (CLB). Niveles más altos (CLB 9+) indican competencia avanzada y reciben más puntos.
    </div>

    <label for="langKnown">Knowledge of official languages *</label>
    <select id="langKnown" aria-describedby="help-langKnown">
      <option value="">-- Selecciona --</option>
      <option value="10">2 Official Languages — 10 puntos</option>
      <option value="5">1 Official Language — 5 puntos</option>
    </select>
    <div id="help-langKnown" class="help">
      <strong>Descripción:</strong> Indica si el candidato domina ambos idiomas oficiales (inglés y francés) o solo uno. Dominar ambos otorga ventaja para integración laboral y comunitaria.
    </div>

    <h3>Regionalization</h3>
    <label for="region">Regional immigration: location of job offer *</label>
    <select id="region" aria-describedby="help-region">
      <option value="">-- Selecciona --</option>
      <option value="10">Northern Ontario — 10 puntos</option>
      <option value="8">Outside GTA (except Northern Ontario) — 8 puntos</option>
      <option value="3">Inside GTA (except Toronto) — 3 puntos</option>
      <option value="0">Toronto — 0 puntos</option>
    </select>
    <div id="help-region" class="help">
      <strong>Descripción:</strong> La ubicación del empleo afecta puntos por regionalización. Zonas con mayor necesidad de población (como el norte de Ontario) reciben más puntos para incentivar la inmigración fuera de los centros urbanos como Toronto.
    </div>

    <div style="margin-top:12px;display:flex;gap:8px">
      <button id="calc" type="button">Calcular puntaje</button>
      <button id="reset" type="button">Limpiar</button>
    </div>
    <p class="small" style="margin-top:10px">Campos marcados son obligatorios. Esta calculadora aplica exactamente los puntajes mostrados en las tablas oficiales.</p>
  </div>

  <div id="output" class="card" style="display:none">
    <h3>Resultado</h3>
    <div id="summary" class="result" aria-live="polite"></div>
    <table id="resultTable" aria-live="polite"></table>
    <button id="downloadPDF" style="margin-top:10px;display:none;">Descargar resultado (PDF)</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;

    function validateSelect(id) {
      const el = document.getElementById(id);
      if (!el.value) { el.style.borderColor = '#b00020'; return false; }
      else { el.style.borderColor = '#bbb'; return true; }
    }

    document.getElementById('calc').addEventListener('click', function() {
      const fields = ['teer','occCat','wage','workPermit','tenure','earnings','clbOverall','langKnown','region'];
      let ok = true;
      fields.forEach(f => { if(!validateSelect(f)) ok = false; });
      if (!ok) { alert('Por favor completa todos los campos.'); return; }

      const values = fields.map(f => Number(document.getElementById(f).value));
      const total = values.reduce((a,b)=>a+b,0);

      document.getElementById('output').style.display = 'block';
      document.getElementById('summary').innerHTML = '<strong>Puntaje total estimado: ' + total + ' puntos</strong>';

      const labels = [
        'Job offer — TEER category','Occupational category','Wage','Work permit',
        'Job tenure','Earnings history','Language (CLB)','Official languages','Region'
      ];

      let html = '<tr><th>Factor</th><th>Puntos</th></tr>';
      labels.forEach((label,i)=> html += `<tr><td>${label}</td><td>${values[i]}</td></tr>`);
      html += `<tr><th>Total</th><th>${total}</th></tr>`;
      document.getElementById('resultTable').innerHTML = html;

      const timestamp = new Date();
      const timestampStr = timestamp.toLocaleString();

      const pdfBtn = document.getElementById('downloadPDF');
      pdfBtn.style.display = 'inline-block';
      pdfBtn.onclick = () => {
        const doc = new jsPDF();
        doc.setFontSize(12);
        doc.text("Resultado — OINP Foreign Worker Stream", 10, 12);
        doc.setFontSize(10);
        doc.text("Fecha / Hora: " + timestampStr, 10, 22);
        doc.text("Puntaje total: " + total + " puntos", 10, 30);
        let y = 40;
        labels.forEach((label,i)=> {
          const line = `${label}: ${values[i]} puntos`;
          doc.text(line, 10, y);
          y += 7;
          if (y > 275) { doc.addPage(); y = 20; }
        });
        doc.save("oinp_resultado.pdf");
      };
    });

    document.getElementById('reset').addEventListener('click', function() {
      document.querySelectorAll('select').forEach(s => { s.value = ''; s.style.borderColor='#bbb'; });
      document.getElementById('output').style.display = 'none';
      document.getElementById('downloadPDF').style.display = 'none';
      document.getElementById('resultTable').innerHTML = '';
      document.getElementById('summary').innerHTML = '';
    });
  </script>
</body>
</html>
